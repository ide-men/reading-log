# 本のステータス管理機能 PRD

## 概要

読書記録アプリに本のステータス管理機能を追加する。本を「カバン」「書斎」「本屋」という3つの場所で管理し、読書の進捗状況を直感的に把握できるようにする。

## 背景・課題

現状の課題:
- 読んだ本しか記録できない
- まだ読んでいない本（積読）を管理できない
- 気になっている本（ウィッシュリスト）を残せない
- 途中で読むのをやめた本を区別できない

## ゴール

- 本のステータスを5種類で管理できる
- 場所のメタファーで直感的に本を整理できる
- ステータス間の遷移をスムーズに行える

---

## 機能仕様

### ステータス定義

| ステータス | 説明 | 場所 |
|-----------|------|------|
| `reading` | 今読んでいる本 | カバン |
| `completed` | 読み終わった本 | 書斎 |
| `unread` | 積読（買ったけど未読） | 書斎 |
| `dropped` | 中断した本 | 書斎 |
| `wishlist` | 気になる・欲しい本 | 本屋 |

### 場所のメタファー

| 場所 | アイコン | ステータス | イメージ |
|------|---------|-----------|----------|
| カバン | 🎒 | `reading` | 持ち歩いている本（複数可） |
| 書斎 | 📚 | `completed` `unread` `dropped` | 家にある本 |
| 本屋 | 🏪 | `wishlist` | 気になっている本 |

---

## 画面構成

### カバン（ホーム画面）

```
🎒 カバン
┌─────────────────────────────┐
│ 今読んでいる本（複数可）      │
│ 📕📗📘                       │
│                             │
│ [+ 本を追加]                 │
└─────────────────────────────┘
```

- 追加時: `reading` として追加
- アクション:
  - 「読み終わった！」→ `completed` へ
  - 「中断する」→ `dropped` へ

### 書斎

```
📚 書斎
┌─────────┬─────────┬─────────┐
│ ✅ 読了 │ 📚 積読 │ ⏸️ 中断 │  ← ラベルボタン
└─────────┴─────────┴─────────┘
┌─────────────────────────────┐
│ 選択中のラベルの本を表示      │
│ 📕📗📘📙📕📗📘📙...          │
│                             │
│ [+ 本を追加]                 │
└─────────────────────────────┘
```

- 追加時: `unread`（積読）として追加
- ラベルボタンで `completed` / `unread` / `dropped` を切り替え
- アクション:
  - 「読み始める！」→ `reading` へ（unread/dropped から）

### 本屋

```
🏪 本屋
┌─────────────────────────────┐
│ 気になる本                   │
│ 📕📗📘                       │
│                             │
│ [+ 本を追加]                 │
└─────────────────────────────┘
```

- 追加時: `wishlist` として追加
- アクション:
  - 「手に入れた！」→ `unread` へ

---

## ステータス遷移

```
🏪 本屋                 📚 書斎                 🎒 カバン
┌──────────┐          ┌──────────┐           ┌──────────┐
│ wishlist │          │  unread  │◀──┐      │ reading  │
└────┬─────┘          └────┬─────┘   │       └────┬─────┘
     │                     │         │            │
     │「手に入れた！」      │「読み始める！」       │
     └────────────────▶    └─────────────────────▶│
                                                  │
                           ┌──────────┐           │
                           │ dropped  │◀──────────┤「中断する」
                           └────┬─────┘           │
                                │                 │
                                │「読み始める！」   │
                                └────────────────▶│
                                                  │
                           ┌──────────┐           │
                           │completed │◀──────────┘「読み終わった！」
                           └──────────┘
```

### 遷移アクション一覧

| 現在 | アクション | 遷移先 | 自動設定 |
|------|-----------|--------|---------|
| `wishlist` | 「手に入れた！」 | `unread` | - |
| `unread` | 「読み始める！」 | `reading` | `startedAt` = 今日 |
| `dropped` | 「読み始める！」 | `reading` | `startedAt` = 今日（未設定の場合） |
| `reading` | 「読み終わった！」 | `completed` | `completedAt` = 今日 |
| `reading` | 「中断する」 | `dropped` | - |

---

## データ構造

### 本オブジェクト（更新後）

```javascript
{
  id: number,              // タイムスタンプ（一意識別子）
  title: string,           // 本のタイトル（必須）
  link: string | null,     // Amazon等のリンク
  coverUrl: string | null, // 表紙画像URL

  // 新規追加
  status: 'reading' | 'completed' | 'unread' | 'wishlist' | 'dropped',
  startedAt: string | null,    // 読み始めた日（ISO date: YYYY-MM-DD）
  completedAt: string | null,  // 読み終わった日（ISO date: YYYY-MM-DD）
  note: string | null,         // 簡単なメモ
}
```

### デフォルト値

新規追加時:
- `status`: ページに応じて自動設定
- `startedAt`: null（読み始め時に設定）
- `completedAt`: null（読了時に設定）
- `note`: null

---

## タイマー連携

### 読書開始時
1. タイマー開始時に本を選択するUIを表示
2. 選択された本を `reading` に変更
3. `startedAt` が未設定なら今日の日付を設定

### 読書終了時
- 「読み終わった」を選択 → `completed` に変更、`completedAt` を設定
- 通常終了 → ステータス変更なし

---

## 本の追加

### ページごとの追加

| ページ | 追加ボタン | 初期ステータス |
|--------|-----------|---------------|
| カバン | 「+ 本を追加」 | `reading` |
| 書斎 | 「+ 本を追加」 | `unread` |
| 本屋 | 「+ 本を追加」 | `wishlist` |

### 追加モーダル

```
┌─────────────────────────────┐
│ 本を追加                     │
├─────────────────────────────┤
│ タイトル: [____________]     │
│ リンク:   [____________]     │
│ メモ:     [____________]     │
│                             │
│     [キャンセル] [追加]      │
└─────────────────────────────┘
```

---

## 本の編集

編集モーダルで以下を変更可能:
- タイトル
- リンク
- ステータス（セレクトボックス）
- 開始日
- 完了日
- メモ

---

## サンプルデータ

各ステータスのパターンを用意:

```javascript
const SAMPLE_BOOKS = [
  // reading（カバン）
  { title: '...', status: 'reading', startedAt: '2024-01-15' },
  { title: '...', status: 'reading', startedAt: '2024-01-20' },

  // completed（書斎・読了）
  { title: '...', status: 'completed', startedAt: '2024-01-01', completedAt: '2024-01-10' },
  { title: '...', status: 'completed', startedAt: '2023-12-01', completedAt: '2024-01-05' },

  // unread（書斎・積読）
  { title: '...', status: 'unread' },
  { title: '...', status: 'unread' },
  { title: '...', status: 'unread' },

  // dropped（書斎・中断）
  { title: '...', status: 'dropped', startedAt: '2024-01-05' },

  // wishlist（本屋）
  { title: '...', status: 'wishlist' },
  { title: '...', status: 'wishlist' },
];
```

---

## マイグレーション

データ初期化するため、マイグレーション不要。

---

## 今後の拡張可能性（スコープ外）

- 本の評価（★）
- 読書時間の本ごとの記録
- 本のカテゴリ/タグ
- 読書目標の設定
