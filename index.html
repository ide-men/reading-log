<!DOCTYPE html>

<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#0a0a0f">
  <title>èª­æ›¸ãƒ­ã‚°</title>
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

:root {
  --bg: #0a0a0f;
  --surface: #12121a;
  --elevated: #1a1a25;
  --accent: #e8a87c;
  --accent-glow: rgba(232, 168, 124, 0.25);
  --text: #f5f5f7;
  --text-dim: #6b6b7a;
  --border: rgba(255, 255, 255, 0.06);
}

html, body {
  height: 100%;
  width: 100%;
  overflow: hidden;
  font-family: 'Noto Sans JP', sans-serif;
  background: var(--bg);
  color: #c9c9d0;
}

/* ã‚¢ãƒ—ãƒªã‚³ãƒ³ãƒ†ãƒŠ - çµ¶å¯¾é…ç½®ã§ç¢ºå®Ÿã« */
.app {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  flex-direction: column;
  max-width: 430px;
  margin: 0 auto;
}

/* ãƒ˜ãƒƒãƒ€ãƒ¼ */
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 20px;
  background: var(--bg);
}

.header h1 {
  font-size: 18px;
  font-weight: 700;
  color: var(--text);
}

.header-btn {
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--elevated);
  border: 1px solid var(--border);
  border-radius: 10px;
  font-size: 16px;
  cursor: pointer;
}

.header-btn.primary {
  background: var(--accent);
  border: none;
  color: var(--bg);
  font-size: 22px;
}

/* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
.content {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  padding: 0 20px 100px;
  -webkit-overflow-scrolling: touch;
}

/* ãƒ›ãƒ¼ãƒ ã‚¿ãƒ–ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã®æ™‚ã¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç„¡åŠ¹ */
.content:has(#tab-home.active) {
  overflow: hidden;
}

/* ã‚¿ãƒ– */
.tab {
  display: none;
}

.tab.active {
  display: block;
}

/* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
.nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  display: flex;
  background: var(--surface);
  border-top: 1px solid var(--border);
  padding: 8px 0;
  padding-bottom: max(8px, env(safe-area-inset-bottom));
  max-width: 430px;
  margin: 0 auto;
}

.nav button {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  padding: 8px;
  background: none;
  border: none;
  cursor: pointer;
}

.nav button span:first-child {
  font-size: 22px;
}

.nav button span:last-child {
  font-size: 10px;
  color: var(--text-dim);
}

.nav button.active span:last-child {
  color: var(--accent);
  font-weight: 500;
}

/* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒªãƒ³ã‚° */
.progress {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px 0;
}

.ring-wrapper {
  position: relative;
  width: 150px;
  height: 150px;
}

.ring-wrapper svg {
  width: 100%;
  height: 100%;
  transform: rotate(-90deg);
}

.ring-wrapper circle {
  fill: none;
  stroke-width: 7;
}

.ring-bg {
  stroke: var(--elevated);
}

.ring-fill {
  stroke: var(--accent);
  stroke-linecap: round;
  stroke-dasharray: 414.69;
  stroke-dashoffset: 414.69;
  transition: stroke-dashoffset 0.5s;
}

.ring-center {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

.ring-level {
  font-size: 34px;
  font-weight: 700;
  color: var(--text);
}

.ring-title {
  font-size: 12px;
  color: var(--accent);
  margin-top: 2px;
}

.xp-text {
  font-size: 12px;
  color: var(--text-dim);
  margin-top: 10px;
}

.xp-text span {
  color: var(--accent);
  font-weight: 700;
}

/* ãƒœã‚¿ãƒ³ */
.main-btn {
  width: 100%;
  padding: 20px 24px;
  font-size: 18px;
  font-weight: 700;
  font-family: inherit;
  border: none;
  border-radius: 28px;
  cursor: pointer;
  background: linear-gradient(135deg, var(--accent), #d4956a);
  color: var(--bg);
  box-shadow:
    0 0 60px var(--accent-glow),
    0 8px 32px rgba(232, 168, 124, 0.35),
    inset 0 1px 0 rgba(255,255,255,0.2);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  position: relative;
  overflow: hidden;
  transition: transform 0.2s, box-shadow 0.2s;
}

.main-btn::before {
  content: '';
  position: absolute;
  inset: -2px;
  border-radius: 30px;
  background: linear-gradient(135deg, var(--accent), #d4956a, var(--accent));
  z-index: -1;
  animation: btn-glow 3s ease-in-out infinite;
}

.main-btn::after {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  animation: btn-shine 4s ease-in-out infinite;
}

@keyframes btn-glow {
  0%, 100% { opacity: 0.5; transform: scale(1); }
  50% { opacity: 0.8; transform: scale(1.02); }
}

@keyframes btn-shine {
  0%, 100% { left: -100%; }
  50% { left: 100%; }
}

.main-btn-icon {
  font-size: 24px;
  display: inline-block;
}

/* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³: ãƒã‚¦ãƒ³ã‚¹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ */
.main-btn-icon.anim-bounce {
  animation: icon-bounce 2s ease-in-out infinite;
}

@keyframes icon-bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-4px); }
}

/* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³: æœ¬ã‚’ã‚ãã‚‹ */
.main-btn-icon.anim-page-flip {
  animation: icon-page-flip 2.5s ease-in-out infinite;
  transform-origin: left center;
}

@keyframes icon-page-flip {
  0%, 100% { transform: rotateY(0deg); }
  25% { transform: rotateY(-20deg); }
  50% { transform: rotateY(0deg); }
  75% { transform: rotateY(15deg); }
}

/* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³: ãƒªãƒ©ãƒƒã‚¯ã‚¹ï¼ˆã‚†ã£ãã‚Šå‘¼å¸ï¼‰ */
.main-btn-icon.anim-relax {
  animation: icon-relax 4s ease-in-out infinite;
}

@keyframes icon-relax {
  0%, 100% {
    transform: scale(1);
    opacity: 0.9;
  }
  50% {
    transform: scale(1.1);
    opacity: 1;
  }
}

/* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³: ç‚ãŒæºã‚‰ã‚ã */
.main-btn-icon.anim-flame {
  animation: icon-flame 0.5s ease-in-out infinite alternate;
}

@keyframes icon-flame {
  0% {
    transform: scale(1) rotate(-3deg);
    filter: brightness(1);
  }
  100% {
    transform: scale(1.08) rotate(3deg);
    filter: brightness(1.2);
  }
}

/* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³: ã‚­ãƒ©ã‚­ãƒ© */
.main-btn-icon.anim-sparkle {
  animation: icon-sparkle 1.5s ease-in-out infinite;
}

@keyframes icon-sparkle {
  0%, 100% {
    transform: scale(1) rotate(0deg);
    filter: brightness(1);
  }
  25% {
    transform: scale(1.1) rotate(5deg);
    filter: brightness(1.3);
  }
  50% {
    transform: scale(1) rotate(0deg);
    filter: brightness(1);
  }
  75% {
    transform: scale(1.1) rotate(-5deg);
    filter: brightness(1.3);
  }
}

/* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³: ãµã‚ãµã‚æµ®éŠ */
.main-btn-icon.anim-float {
  animation: icon-float 3s ease-in-out infinite;
}

@keyframes icon-float {
  0%, 100% { transform: translateY(0) rotate(0deg); }
  25% { transform: translateY(-3px) rotate(3deg); }
  50% { transform: translateY(-5px) rotate(0deg); }
  75% { transform: translateY(-3px) rotate(-3deg); }
}

/* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³: æ³¢æ‰“ã¤ */
.main-btn-icon.anim-wave {
  animation: icon-wave 2s ease-in-out infinite;
}

@keyframes icon-wave {
  0%, 100% { transform: rotate(0deg); }
  25% { transform: rotate(10deg); }
  75% { transform: rotate(-10deg); }
}

.main-btn:hover {
  transform: translateY(-2px);
  box-shadow:
    0 0 80px var(--accent-glow),
    0 12px 40px rgba(232, 168, 124, 0.4),
    inset 0 1px 0 rgba(255,255,255,0.2);
}

.main-btn:active {
  transform: scale(0.98) translateY(0);
}

/* ãƒ›ãƒ¼ãƒ ã‚¿ãƒ– - ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç„¡åŠ¹ãƒ»ç”»é¢å›ºå®š */
#tab-home {
  height: 100%;
  overflow: hidden;
  position: relative;
}

/* ãƒ›ãƒ¼ãƒ ã‚¿ãƒ–ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã®æ™‚ã®ã¿flexboxã‚’é©ç”¨ */
#tab-home.active {
  display: flex;
  flex-direction: column;
}

/* ãƒ›ãƒ¼ãƒ ç”»é¢ - ä¸­å¤®é…ç½® */
.home-center {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

/* å¼•ç”¨ - ä¸‹éƒ¨ã«æ§ãˆã‚ã« */
.quote-bottom {
  padding: 20px;
  padding-bottom: 10px;
  text-align: center;
  opacity: 0.6;
}

.quote-bottom p:first-child {
  font-size: 12px;
  font-style: italic;
  line-height: 1.6;
  color: var(--text-dim);
}

.quote-bottom p:last-child {
  font-size: 10px;
  color: var(--text-dim);
  margin-top: 4px;
}

/* æœ¬æ£šã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
.bookshelf {
  background: linear-gradient(to bottom, #1a1410, var(--surface) 70%);
  margin: 0 -20px 20px;
  padding: 24px 20px 20px;
  text-align: center;
}

.bookshelf-header {
  margin-bottom: 16px;
}

.bookshelf-emoji {
  font-size: 40px;
  margin-bottom: 8px;
  filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
}

.bookshelf-title-main {
  font-size: 20px;
  font-weight: 700;
  color: var(--text);
  margin-bottom: 4px;
}

.bookshelf-subtitle {
  font-size: 13px;
  color: var(--text-dim);
  opacity: 0.8;
}

.bookshelf-stats {
  margin-bottom: 16px;
}

.bookshelf-stat-main {
  display: inline-flex;
  align-items: baseline;
  gap: 6px;
  background: rgba(232, 168, 124, 0.1);
  border: 1px solid rgba(232, 168, 124, 0.2);
  border-radius: 20px;
  padding: 8px 20px;
}

.bookshelf-count {
  font-size: 32px;
  font-weight: 700;
  color: var(--accent);
}

.bookshelf-label {
  font-size: 14px;
  color: var(--text-dim);
}

/* æœ¬æ£šã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ */
.books-summary {
  display: none;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
  margin-bottom: 20px;
}

.books-summary.has-books {
  display: grid;
}

.books-summary-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 16px;
  text-align: center;
  position: relative;
  overflow: hidden;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.books-summary-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  opacity: 0.08;
  transition: opacity 0.2s ease;
}

.books-summary-card-recent::before {
  background: linear-gradient(135deg, #e8a87c 0%, #f0c27b 100%);
}

.books-summary-card-xp::before {
  background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
}

.books-summary-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
}

.books-summary-icon {
  font-size: 24px;
  margin-bottom: 8px;
  filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
}

.books-summary-value {
  font-size: 18px;
  font-weight: 700;
  color: var(--text);
  margin-bottom: 2px;
  position: relative;
  z-index: 1;
}

.books-summary-label {
  font-size: 11px;
  color: var(--text-dim);
  position: relative;
  z-index: 1;
}

/* æœ¬ãƒªã‚¹ãƒˆãƒ’ãƒ³ãƒˆ */
.books-list-hint {
  display: none;
  align-items: center;
  gap: 8px;
  font-size: 12px;
  color: var(--text-dim);
  background: var(--surface);
  border-radius: 8px;
  padding: 8px 12px;
  margin-bottom: 12px;
}

.books-list-hint.visible {
  display: flex;
}

/* æœ¬æ£šã®ãƒ’ãƒ³ãƒˆ */
.books-tip {
  display: flex;
  align-items: center;
  gap: 8px;
  background: rgba(232, 168, 124, 0.08);
  border: 1px solid rgba(232, 168, 124, 0.15);
  border-radius: 12px;
  padding: 12px 16px;
  font-size: 13px;
  color: var(--text-dim);
  margin-top: 20px;
}

/* æœ¬æ£šãƒ•ãƒ¬ãƒ¼ãƒ  */
.shelf-container {
  margin-top: 20px;
  background: linear-gradient(135deg, #2a1f18 0%, #3d2e24 50%, #2a1f18 100%);
  border: 4px solid #1a1410;
  border-radius: 8px;
  padding: 0 8px;
  box-shadow:
    inset 0 0 20px rgba(0,0,0,0.4),
    0 8px 20px rgba(0,0,0,0.5);
  position: relative;
  overflow: visible;
}

/* æœ¨ç›®ãƒ†ã‚¯ã‚¹ãƒãƒ£ */
.shelf-container::before {
  content: '';
  position: absolute;
  inset: 0;
  background: repeating-linear-gradient(
    90deg,
    transparent 0px,
    rgba(255,255,255,0.02) 1px,
    transparent 2px,
    transparent 20px
  );
  pointer-events: none;
  border-radius: 4px;
}

/* æ£šæ¿ - ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚³ãƒ³ãƒ†ãƒŠ */
.shelf-board {
  position: relative;
  margin-bottom: 4px;
  overflow-x: auto;
  overflow-y: visible;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
  padding-top: 80px;
  margin-top: -80px;
  touch-action: pan-x;
}

.shelf-board::-webkit-scrollbar {
  display: none;
}

.shelf-visual {
  display: flex;
  justify-content: flex-start;
  align-items: flex-end;
  gap: 4px;
  min-height: 80px;
  padding: 12px 8px 0;
  width: fit-content;
  min-width: 100%;
  position: relative;
}

/* æ£šæ¿ã®æ¿éƒ¨åˆ† */
.shelf-visual::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 12px;
  background: linear-gradient(to bottom,
    #5a4a3a 0%,
    #4a3a2a 40%,
    #3a2a1a 100%
  );
  border-radius: 0 0 4px 4px;
  box-shadow:
    0 4px 8px rgba(0,0,0,0.4),
    inset 0 2px 0 rgba(255,255,255,0.1);
}

/* æœ¬ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.mini-book {
  min-width: 14px;
  border-radius: 2px 3px 0 0;
  cursor: pointer;
  position: relative;
  transform-style: preserve-3d;
  transition: transform 0.2s ease;
  box-shadow:
    2px 0 0 rgba(0,0,0,0.3),
    -1px 0 0 rgba(255,255,255,0.1);
}

.mini-book::before {
  content: '';
  position: absolute;
  top: 4px;
  left: 2px;
  right: 2px;
  bottom: 4px;
  background: linear-gradient(
    to right,
    rgba(255,255,255,0.15) 0%,
    transparent 30%,
    transparent 70%,
    rgba(0,0,0,0.2) 100%
  );
  border-radius: 1px;
}

/* èƒŒè¡¨ç´™ã®è£…é£¾ç·š */
.mini-book::after {
  content: '';
  position: absolute;
  top: 6px;
  left: 50%;
  transform: translateX(-50%);
  width: 60%;
  height: 2px;
  background: rgba(255,255,255,0.2);
  border-radius: 1px;
}

.mini-book:hover {
  transform: translateY(-6px) scale(1.05) !important;
  z-index: 10;
  box-shadow:
    2px 0 0 rgba(0,0,0,0.3),
    -1px 0 0 rgba(255,255,255,0.1),
    0 8px 16px rgba(0,0,0,0.4);
}

/* è¡¨ç´™ç”»åƒãŒã‚ã‚‹æœ¬ã¯è£…é£¾ã‚’éè¡¨ç¤º */
.mini-book.has-cover::before,
.mini-book.has-cover::after {
  display: none;
}

.mini-book.has-cover {
  border-radius: 2px 4px 0 0;
  box-shadow:
    2px 0 0 rgba(0,0,0,0.4),
    -1px 0 0 rgba(255,255,255,0.1),
    0 2px 4px rgba(0,0,0,0.3);
}

/* ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ— */
.book-tooltip {
  position: absolute;
  bottom: calc(100% + 8px);
  left: 50%;
  transform: translateX(-50%);
  background: var(--elevated);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 10px 12px;
  min-width: 140px;
  max-width: 200px;
  z-index: 100;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.2s, visibility 0.2s;
  pointer-events: none;
}

/* å·¦ç«¯ã®æœ¬ç”¨ï¼šå³å¯„ã› */
.book-tooltip.tooltip-align-left {
  left: 0;
  transform: translateX(0);
}

.book-tooltip.tooltip-align-left::after {
  left: 12px;
  transform: translateX(0);
}

/* å³ç«¯ã®æœ¬ç”¨ï¼šå·¦å¯„ã› */
.book-tooltip.tooltip-align-right {
  left: auto;
  right: 0;
  transform: translateX(0);
}

.book-tooltip.tooltip-align-right::after {
  left: auto;
  right: 12px;
  transform: translateX(0);
}

.mini-book:hover .book-tooltip,
.book-tooltip:hover {
  opacity: 1;
  visibility: visible;
  pointer-events: auto;
}

.book-tooltip::after {
  content: '';
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  border: 6px solid transparent;
  border-top-color: var(--elevated);
}

.tooltip-title {
  font-size: 12px;
  color: var(--text);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.tooltip-title:not(:last-child) {
  margin-bottom: 6px;
}

.tooltip-btn {
  display: block;
  width: 100%;
  padding: 6px 10px;
  font-size: 11px;
  font-family: inherit;
  background: var(--accent);
  border: none;
  border-radius: 6px;
  color: var(--bg);
  cursor: pointer;
  text-align: center;
}

.empty-shelf {
  color: var(--text-dim);
  font-size: 14px;
  padding: 30px 20px;
  text-align: center;
}

.empty-shelf-icon {
  font-size: 36px;
  margin-bottom: 12px;
  opacity: 0.6;
}

.empty-shelf-text {
  color: var(--text);
  font-weight: 500;
  margin-bottom: 4px;
}

.empty-shelf-hint {
  font-size: 12px;
  opacity: 0.8;
}

/* æœ¬ãƒªã‚¹ãƒˆ */
.book-item {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 14px 0;
  border-bottom: 1px solid var(--border);
}

.book-icon {
  width: 40px;
  height: 54px;
  background: var(--elevated);
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  flex-shrink: 0;
  overflow: hidden;
  position: relative;
}

.book-cover {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 4px;
}

.book-icon-fallback {
  display: none;
  width: 100%;
  height: 100%;
  align-items: center;
  justify-content: center;
}

.book-icon-emoji {
  display: flex;
  width: 100%;
  height: 100%;
  align-items: center;
  justify-content: center;
}

.book-info {
  flex: 1;
  min-width: 0;
}

.book-name {
  font-size: 14px;
  color: var(--text);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.book-name a {
  color: inherit;
  text-decoration: none;
}

.book-date {
  font-size: 11px;
  color: var(--text-dim);
  margin-top: 2px;
}

.book-xp {
  background: rgba(232, 168, 124, 0.1);
  color: var(--accent);
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 10px;
  margin-left: 6px;
}

.book-actions {
  display: flex;
  gap: 4px;
}

.book-actions button {
  background: none;
  border: none;
  color: var(--text-dim);
  font-size: 16px;
  padding: 8px;
  cursor: pointer;
}

/* è¨˜éŒ²ã‚¿ãƒ– */
.impact-card {
  background: linear-gradient(135deg, var(--accent), #d4956a);
  border-radius: 24px;
  padding: 28px;
  text-align: center;
  color: var(--bg);
  margin-bottom: 20px;
}

.impact-value {
  font-size: 40px;
  font-weight: 700;
}

.impact-label {
  font-size: 14px;
  opacity: 0.8;
}

.streak-badge {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  background: rgba(0,0,0,0.15);
  padding: 6px 12px;
  border-radius: 20px;
  margin-top: 12px;
}

.streak-fire {
  font-size: 16px;
}

.streak-count {
  font-size: 18px;
  font-weight: 700;
}

.streak-label {
  font-size: 12px;
  opacity: 0.9;
}

.prediction-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 18px 20px;
  margin-bottom: 12px;
  position: relative;
  overflow: hidden;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.prediction-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  opacity: 0.08;
  transition: opacity 0.2s ease;
}

.prediction-card-yearly::before {
  background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
}

.prediction-card-title::before {
  background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
}

.prediction-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
}

.prediction-card:hover::before {
  opacity: 0.15;
}

.prediction-item {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 4px 0;
  position: relative;
  z-index: 1;
}

.prediction-icon {
  font-size: 32px;
  flex-shrink: 0;
  filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
}

.prediction-content {
  flex: 1;
}

.prediction-value {
  font-size: 22px;
  font-weight: 700;
  color: var(--text);
  margin-bottom: 2px;
}

.prediction-label {
  font-size: 13px;
  color: var(--accent);
  font-weight: 500;
  margin-bottom: 4px;
}

.prediction-hint {
  font-size: 11px;
  color: var(--text-dim);
  opacity: 0.8;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  margin-bottom: 20px;
}

.stats-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 16px;
  text-align: center;
}

.stats-card-value {
  font-size: 24px;
  font-weight: 700;
  color: var(--text);
}

.stats-card-label {
  font-size: 10px;
  color: var(--text-dim);
  margin-top: 2px;
}

.section-title {
  font-size: 12px;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 0.1em;
  margin-bottom: 12px;
}

.week-chart {
  display: flex;
  align-items: flex-end;
  gap: 8px;
  height: 100px;
  padding: 12px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 16px;
  margin-bottom: 20px;
}

.week-bar {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
}

.week-bar-fill {
  width: 100%;
  max-width: 24px;
  background: var(--accent);
  border-radius: 4px 4px 0 0;
  min-height: 4px;
}

.week-bar-fill.empty {
  background: var(--elevated);
}

.week-bar span {
  font-size: 10px;
  color: var(--text-dim);
}

.week-bar.today span {
  color: var(--accent);
  font-weight: 500;
}

.style-card {
  display: flex;
  align-items: center;
  gap: 16px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 18px 20px;
  margin-bottom: 12px;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  position: relative;
  overflow: hidden;
}

.style-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  opacity: 0.08;
  transition: opacity 0.2s ease;
}

.style-card-focus::before {
  background: linear-gradient(135deg, #e8a87c 0%, #f0c27b 100%);
}

.style-card-time::before {
  background: linear-gradient(135deg, #6b5b95 0%, #a78bfa 100%);
}

.style-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
}

.style-card:hover::before {
  opacity: 0.15;
}

.style-icon {
  font-size: 32px;
  flex-shrink: 0;
  filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
}

.style-content {
  flex: 1;
  position: relative;
  z-index: 1;
}

.style-value {
  font-size: 20px;
  font-weight: 700;
  color: var(--text);
  margin-bottom: 2px;
}

.style-label {
  font-size: 13px;
  color: var(--accent);
  font-weight: 500;
  margin-bottom: 4px;
}

.style-hint {
  font-size: 11px;
  color: var(--text-dim);
  opacity: 0.8;
}

.tip {
  display: flex;
  align-items: center;
  gap: 10px;
  background: rgba(232, 168, 124, 0.1);
  border-radius: 16px;
  padding: 14px 16px;
  margin-top: 20px;
}

.tip span:first-child {
  font-size: 18px;
}

.tip span:last-child {
  font-size: 13px;
}

/* èª­æ›¸ç”»é¢ */
.reading-screen {
  position: fixed;
  inset: 0;
  background: var(--bg);
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 100;
}

.reading-screen.active {
  display: flex;
}

/* èª­æ›¸ä¸­ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ - è½ã¡ç€ã„ãŸç³» */
.reading-anim {
  width: 120px;
  height: 120px;
  margin-bottom: 40px;
  position: relative;
}

.reading-glow {
  position: absolute;
  inset: -10px;
  background: radial-gradient(circle, var(--accent-glow), transparent 70%);
  border-radius: 50%;
  animation: reading-glow-pulse 6s ease-in-out infinite;
}

.reading-icon {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 56px;
}

/* å‘¼å¸ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ */
.reading-anim.anim-breath .reading-icon {
  animation: reading-breath 5s ease-in-out infinite;
}

.reading-anim.anim-breath .reading-glow {
  animation: reading-glow-breath 5s ease-in-out infinite;
}

@keyframes reading-breath {
  0%, 100% {
    transform: translate(-50%, -50%) scale(1);
    opacity: 0.9;
  }
  50% {
    transform: translate(-50%, -50%) scale(1.08);
    opacity: 1;
  }
}

@keyframes reading-glow-breath {
  0%, 100% { transform: scale(1); opacity: 0.3; }
  50% { transform: scale(1.1); opacity: 0.5; }
}

/* ã‚†ã£ãŸã‚Šæµ®éŠã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
.reading-anim.anim-float .reading-icon {
  animation: reading-float 6s ease-in-out infinite;
}

.reading-anim.anim-float .reading-glow {
  animation: reading-glow-float 6s ease-in-out infinite;
}

@keyframes reading-float {
  0%, 100% {
    transform: translate(-50%, -50%) translateY(0);
  }
  50% {
    transform: translate(-50%, -50%) translateY(-8px);
  }
}

@keyframes reading-glow-float {
  0%, 100% { transform: scale(1) translateY(0); opacity: 0.35; }
  50% { transform: scale(1.05) translateY(-4px); opacity: 0.45; }
}

/* ç©ã‚„ã‹ãªæºã‚‰ãã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
.reading-anim.anim-sway .reading-icon {
  animation: reading-sway 7s ease-in-out infinite;
}

.reading-anim.anim-sway .reading-glow {
  animation: reading-glow-sway 7s ease-in-out infinite;
}

@keyframes reading-sway {
  0%, 100% {
    transform: translate(-50%, -50%) rotate(0deg);
  }
  25% {
    transform: translate(-50%, -50%) rotate(3deg);
  }
  75% {
    transform: translate(-50%, -50%) rotate(-3deg);
  }
}

@keyframes reading-glow-sway {
  0%, 100% { transform: scale(1); opacity: 0.35; }
  50% { transform: scale(1.08); opacity: 0.45; }
}

/* é™ã‹ãªç‘æƒ³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
.reading-anim.anim-zen .reading-icon {
  animation: reading-zen 8s ease-in-out infinite;
}

.reading-anim.anim-zen .reading-glow {
  animation: reading-glow-zen 8s ease-in-out infinite;
}

@keyframes reading-zen {
  0%, 100% {
    transform: translate(-50%, -50%) scale(1);
    filter: brightness(1);
  }
  50% {
    transform: translate(-50%, -50%) scale(1.05);
    filter: brightness(1.1);
  }
}

@keyframes reading-glow-zen {
  0%, 100% { transform: scale(1); opacity: 0.25; }
  50% { transform: scale(1.15); opacity: 0.4; }
}

/* æ±ç”¨ã®ç©ã‚„ã‹ãªã‚°ãƒ­ãƒ¼ */
@keyframes reading-glow-pulse {
  0%, 100% { transform: scale(1); opacity: 0.3; }
  50% { transform: scale(1.1); opacity: 0.45; }
}

.reading-label {
  font-size: 15px;
  color: var(--text-dim);
  margin-bottom: 48px;
}

.reading-stop {
  padding: 14px 40px;
  font-size: 14px;
  font-family: inherit;
  background: var(--elevated);
  border: 1px solid var(--border);
  border-radius: 12px;
  color: var(--text);
  cursor: pointer;
}

/* ãƒ¢ãƒ¼ãƒ€ãƒ« */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  display: none;
  align-items: flex-end;
  justify-content: center;
  z-index: 200;
}

.modal-overlay.active {
  display: flex;
}

.modal {
  background: var(--surface);
  border-radius: 24px 24px 0 0;
  width: 100%;
  max-width: 430px;
  max-height: 85vh;
  overflow-y: auto;
  animation: slideUp 0.3s ease;
}

@keyframes slideUp {
  from { transform: translateY(100%); }
  to { transform: translateY(0); }
}

.modal-bar {
  width: 36px;
  height: 4px;
  background: var(--text-dim);
  border-radius: 2px;
  margin: 12px auto;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 20px 16px;
}

.modal-header h2 {
  font-size: 18px;
  font-weight: 700;
  color: var(--text);
}

.modal-close {
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--elevated);
  border: none;
  border-radius: 8px;
  color: var(--text-dim);
  font-size: 18px;
  cursor: pointer;
}

.modal-body {
  padding: 0 20px 28px;
}

.celebration {
  text-align: center;
  padding: 16px 0 20px;
}

.celebration-icon {
  font-size: 40px;
}

.celebration-text {
  font-size: 14px;
  color: var(--text-dim);
  margin-top: 8px;
}

.form-group {
  margin-bottom: 16px;
}

.form-label {
  display: block;
  font-size: 12px;
  color: var(--text-dim);
  margin-bottom: 6px;
}

.form-input {
  width: 100%;
  padding: 14px;
  font-size: 16px;
  font-family: inherit;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 12px;
  color: var(--text);
}

.form-input:focus {
  outline: none;
  border-color: var(--accent);
}

.btn {
  width: 100%;
  padding: 16px;
  font-size: 15px;
  font-weight: 700;
  font-family: inherit;
  border: none;
  border-radius: 12px;
  cursor: pointer;
}

.btn-primary {
  background: linear-gradient(135deg, var(--accent), #d4956a);
  color: var(--bg);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}

.btn-secondary {
  background: transparent;
  border: 1px solid var(--border);
  color: var(--text-dim);
  margin-top: 10px;
}

.btn-danger {
  background: rgba(248,113,113,0.1);
  border: 1px solid rgba(248,113,113,0.3);
  color: #f87171;
}

.btn-badge {
  background: rgba(0,0,0,0.15);
  padding: 3px 8px;
  border-radius: 4px;
  font-size: 12px;
}

.link-toggle {
  display: flex;
  align-items: center;
  gap: 6px;
  background: none;
  border: none;
  color: var(--text-dim);
  font-size: 12px;
  font-family: inherit;
  cursor: pointer;
  padding: 6px 0;
}

.link-fields {
  margin-top: 10px;
  display: none;
}

.link-fields.open {
  display: block;
}

.settings-hint {
  font-size: 11px;
  color: var(--text-dim);
  margin-top: 8px;
  text-align: center;
}

/* ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚° */
.confirm-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.8);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 300;
  padding: 20px;
}

.confirm-overlay.active {
  display: flex;
}

.confirm-box {
  background: var(--surface);
  border-radius: 16px;
  padding: 32px;
  max-width: 340px;
  width: 100%;
  text-align: center;
}

.confirm-icon {
  font-size: 42px;
  margin-bottom: 16px;
}

.confirm-title {
  font-size: 18px;
  font-weight: 700;
  color: var(--text);
  margin-bottom: 10px;
}

.confirm-text {
  font-size: 14px;
  color: var(--text-dim);
  margin-bottom: 24px;
  line-height: 1.5;
}

.confirm-btns {
  display: flex;
  gap: 12px;
}

.confirm-btns button {
  flex: 1;
  padding: 14px;
  font-size: 15px;
  font-family: inherit;
  border-radius: 12px;
  cursor: pointer;
}

.confirm-cancel {
  background: var(--bg);
  border: 1px solid var(--border);
  color: var(--text);
}

.confirm-ok {
  background: #dc2626;
  border: none;
  color: white;
  font-weight: 700;
}

.confirm-ok.link {
  background: var(--accent);
  color: var(--bg);
}

/* ãƒˆãƒ¼ã‚¹ãƒˆ */
.toast {
  position: fixed;
  bottom: 90px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--elevated);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 12px 20px;
  font-size: 13px;
  color: var(--text);
  z-index: 250;
  animation: toastIn 0.3s ease, toastOut 0.3s ease 2.7s forwards;
}

@keyframes toastIn {
  from { opacity: 0; transform: translateX(-50%) translateY(10px); }
  to { opacity: 1; transform: translateX(-50%) translateY(0); }
}

@keyframes toastOut {
  to { opacity: 0; }
}

/* ç´™å¹é›ª */
.confetti {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 500;
  overflow: hidden;
}

.confetti i {
  position: absolute;
  width: 8px;
  height: 8px;
  animation: fall 3s ease-out forwards;
}

@keyframes fall {
  0% { transform: translateY(-50px) rotate(0); opacity: 1; }
  100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
}

/* ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ— */
.levelup-overlay {
  position: fixed;
  inset: 0;
  background: rgba(10,10,15,0.95);
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 400;
}

.levelup-overlay.active {
  display: flex;
}

.levelup-content {
  text-align: center;
  animation: popIn 0.5s ease;
}

@keyframes popIn {
  from { opacity: 0; transform: scale(0.8); }
  to { opacity: 1; transform: scale(1); }
}

.levelup-icon {
  font-size: 64px;
  margin-bottom: 20px;
}

.levelup-label {
  font-size: 13px;
  color: var(--accent);
  letter-spacing: 0.15em;
  margin-bottom: 8px;
}

.levelup-value {
  font-size: 42px;
  font-weight: 700;
  color: var(--text);
}

.levelup-sub {
  font-size: 14px;
  color: var(--text-dim);
  margin-top: 4px;
}

.levelup-btn {
  margin-top: 40px;
  padding: 12px 28px;
  font-size: 13px;
  font-family: inherit;
  background: var(--elevated);
  border: 1px solid var(--border);
  border-radius: 12px;
  color: var(--text);
  cursor: pointer;
}

  </style>
</head>
<body>
  <div class="app">
    <header class="header">
      <h1>ğŸ“– Reading Log</h1>
      <button class="header-btn" id="settingsBtn">âš™ï¸</button>
    </header>

<div class="content">
  <!-- ãƒ›ãƒ¼ãƒ ã‚¿ãƒ– -->
  <div class="tab active" id="tab-home">
    <div class="home-center">
      <button class="main-btn" id="startBtn">
        <span class="main-btn-icon">ğŸ“–</span>
        <span>èª­æ›¸ã‚’ã¯ã˜ã‚ã‚‹</span>
      </button>
    </div>

    <div class="quote-bottom">
      <p id="quoteText">èª­æ›¸ã¯å¿ƒã®æ—…è·¯ã€‚ä¸€ãƒšãƒ¼ã‚¸ãŒæ–°ã—ã„ä¸–ç•Œã¸ã®æ‰‰ã¨ãªã‚‹ã€‚</p>
      <p id="quoteAuthor">â€” ä»Šæ—¥ã®ä¸€è¨€</p>
    </div>
  </div>
  
  <!-- æœ¬æ£šã‚¿ãƒ– -->
  <div class="tab" id="tab-books">
    <div class="bookshelf">
      <div class="bookshelf-header">
        <div class="bookshelf-emoji">ğŸ“š</div>
        <div class="bookshelf-title-main">ã‚ãªãŸã®æœ¬æ£š</div>
        <div class="bookshelf-subtitle">èª­ã¿çµ‚ãˆãŸæœ¬ãŒã“ã“ã«ä¸¦ã³ã¾ã™</div>
      </div>
      <div class="bookshelf-stats">
        <div class="bookshelf-stat-main">
          <div class="bookshelf-count" id="bookCount">0</div>
          <div class="bookshelf-label">å†Šèª­äº†</div>
        </div>
      </div>
      <div class="shelf-container">
        <div class="shelf-board">
          <div class="shelf-visual" id="shelf"></div>
        </div>
      </div>
    </div>

    <div class="books-summary" id="booksSummary"></div>

    <h3 class="section-title" id="booksListTitle">ğŸ“– èª­äº†ãƒªã‚¹ãƒˆ</h3>
    <div class="books-list-hint" id="booksListHint">
      <span>ğŸ’¡</span>
      <span>æœ¬ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ç·¨é›†ã§ãã¾ã™</span>
    </div>
    <div id="bookList"></div>

    <div class="books-tip" id="booksTip">
      <span>ğŸ’¡</span>
      <span id="booksTipText">èª­æ›¸ã‚’è¨˜éŒ²ã—ã¦æœ¬æ£šã‚’è‚²ã¦ã‚ˆã†</span>
    </div>
  </div>
  
  <!-- è¨˜éŒ²ã‚¿ãƒ– -->
  <div class="tab" id="tab-stats">
    <div class="progress">
      <div class="ring-wrapper">
        <svg viewBox="0 0 140 140">
          <circle class="ring-bg" cx="70" cy="70" r="66"/>
          <circle class="ring-fill" id="xpRing" cx="70" cy="70" r="66"/>
        </svg>
        <div class="ring-center">
          <div class="ring-level" id="levelDisplay">Lv.1</div>
          <div class="ring-title" id="titleDisplay">èª­æ›¸ãƒ“ã‚®ãƒŠãƒ¼</div>
        </div>
      </div>
      <div class="xp-text">æ¬¡ã®ãƒ¬ãƒ™ãƒ«ã¾ã§ <span id="xpProgress">0</span> / <span id="xpNeeded">5</span> XP</div>
    </div>

    <div class="stats-grid">
      <div class="stats-card">
        <div class="stats-card-value" id="totalHours">0</div>
        <div class="stats-card-label">èª­ã‚“ã§ããŸæ™‚é–“</div>
      </div>
      <div class="stats-card">
        <div class="stats-card-value" id="totalSessions">0</div>
        <div class="stats-card-label">æœ¬ã‚’é–‹ã„ãŸå›æ•°</div>
      </div>
      <div class="stats-card">
        <div class="stats-card-value" id="daysSince">1</div>
        <div class="stats-card-label">ä¸€ç·’ã«èª­æ›¸ã—ãŸæ—¥æ•°</div>
      </div>
    </div>
    
    <h3 class="section-title">ä»Šé€±ã®èª­æ›¸</h3>
    <div class="week-chart" id="weekChart"></div>

    <h3 class="section-title">ğŸ”® ã“ã®å…ˆã®èª­æ›¸ãƒ©ã‚¤ãƒ•</h3>
    <div class="prediction-card prediction-card-yearly">
      <div class="prediction-item">
        <span class="prediction-icon">ğŸ“ˆ</span>
        <div class="prediction-content">
          <div class="prediction-value" id="yearlyPrediction">--å†Š</div>
          <div class="prediction-label">ä»Šå¹´ã®èª­äº†äºˆæƒ³</div>
          <div class="prediction-hint">ã“ã®ãƒšãƒ¼ã‚¹ã§èª­ã¿ç¶šã‘ã‚‹ã¨â€¦</div>
        </div>
      </div>
    </div>
    <div class="prediction-card prediction-card-title">
      <div class="prediction-item">
        <span class="prediction-icon">â­</span>
        <div class="prediction-content">
          <div class="prediction-value" id="nextTitle">--</div>
          <div class="prediction-label">æ¬¡ã«å¾…ã£ã¦ã„ã‚‹ç§°å·</div>
          <div class="prediction-hint" id="nextTitleLabel">æ¬¡ã®ç§°å·ã¾ã§</div>
        </div>
      </div>
    </div>

    <h3 class="section-title">ğŸ“– ã‚ãªãŸã‚‰ã—ã„èª­æ›¸</h3>
    <div class="style-card style-card-focus">
      <span class="style-icon">ğŸ¯</span>
      <div class="style-content">
        <div class="style-value" id="avgFocus">--</div>
        <div class="style-label">ã„ã¤ã‚‚ã®é›†ä¸­ã‚¿ã‚¤ãƒ </div>
        <div class="style-hint">1å›ã®èª­æ›¸ã§é›†ä¸­ã—ã¦ã„ã‚‹æ™‚é–“</div>
      </div>
    </div>
    <div class="style-card style-card-time">
      <span class="style-icon" id="timeIcon">ğŸŒ™</span>
      <div class="style-content">
        <div class="style-value" id="timeType">--</div>
        <div class="style-label">èª­æ›¸ã®ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¿ã‚¤ãƒ </div>
        <div class="style-hint">ã‚ãªãŸãŒæœ¬ã‚’é–‹ãã‚„ã™ã„æ™‚é–“å¸¯</div>
      </div>
    </div>
    
    <div class="tip">
      <span>ğŸ’¡</span>
      <span id="tipText">èª­æ›¸ã‚’å§‹ã‚ã¦è¨˜éŒ²ã‚’ä½œã‚ã†</span>
    </div>
  </div>
</div>

<nav class="nav">
  <button class="active" data-tab="home"><span>ğŸ </span><span>ãƒ›ãƒ¼ãƒ </span></button>
  <button data-tab="books"><span>ğŸ“š</span><span>æœ¬æ£š</span></button>
  <button data-tab="stats"><span>ğŸ“Š</span><span>è¨˜éŒ²</span></button>
</nav>

  </div>

  <!-- èª­æ›¸ç”»é¢ -->

  <div class="reading-screen" id="readingScreen">
    <div class="reading-anim" id="readingAnim">
      <div class="reading-glow"></div>
      <div class="reading-icon" id="readingIcon">ğŸ“–</div>
    </div>
    <p class="reading-label" id="readingLabel">èª­æ›¸ã«é›†ä¸­ã—ã¦ã„ã¾ã™</p>
    <button class="reading-stop" id="stopBtn">èª­æ›¸ã‚’ãŠã‚ã‚‹</button>
  </div>

  <!-- æœ¬è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ« -->

  <div class="modal-overlay" id="addBookModal">
    <div class="modal">
      <div class="modal-bar"></div>
      <div class="modal-header">
        <h2>èª­äº†ã‚’è¨˜éŒ²</h2>
        <button class="modal-close" data-close="addBookModal">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="celebration">
          <div class="celebration-icon">ğŸŠ</div>
          <p class="celebration-text">1å†Šèª­ã¿çµ‚ãˆãŸè‡ªåˆ†ã‚’è¤’ã‚ã‚ˆã†</p>
        </div>
        <div class="form-group">
          <label class="form-label">ã‚¿ã‚¤ãƒˆãƒ«</label>
          <input type="text" class="form-input" id="bookInput" placeholder="ä¾‹ï¼šäººã‚’å‹•ã‹ã™">
        </div>
        <div class="form-group">
          <button class="link-toggle" id="linkToggle">
            <span id="linkIcon">+</span>
            <span>ãƒªãƒ³ã‚¯ã‚’è¿½åŠ </span>
          </button>
          <div class="link-fields" id="linkFields">
            <input type="url" class="form-input" id="linkInput" placeholder="amazon.co.jp/dp/...ã®ãƒ•ãƒ«URL(çŸ­ç¸®URLã¯éå¯¾å¿œ)">
          </div>
        </div>
        <button class="btn btn-primary" id="addBookBtn">
          <span>èª­äº†ï¼</span>
          <span class="btn-badge">+10 XP</span>
        </button>
        <button class="btn btn-secondary" id="addBookNoXpBtn">éå»ã«èª­ã‚“ã æœ¬ã‚’è¿½åŠ </button>
      </div>
    </div>
  </div>

  <!-- ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->

  <div class="modal-overlay" id="editBookModal">
    <div class="modal">
      <div class="modal-bar"></div>
      <div class="modal-header">
        <h2>æœ¬ã‚’ç·¨é›†</h2>
        <button class="modal-close" data-close="editBookModal">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">ã‚¿ã‚¤ãƒˆãƒ«</label>
          <input type="text" class="form-input" id="editBookTitle" placeholder="ä¾‹ï¼šäººã‚’å‹•ã‹ã™">
        </div>
        <div class="form-group">
          <label class="form-label">ãƒªãƒ³ã‚¯ï¼ˆä»»æ„ï¼‰</label>
          <input type="url" class="form-input" id="editBookLink" placeholder="amazon.co.jp/dp/...ã®ãƒ•ãƒ«URL(çŸ­ç¸®URLã¯éå¯¾å¿œ)">
        </div>
        <button class="btn btn-primary" id="saveEditBtn">ä¿å­˜</button>
        <button class="btn btn-secondary" data-close="editBookModal">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      </div>
    </div>
  </div>

  <!-- è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« -->

  <div class="modal-overlay" id="settingsModal">
    <div class="modal">
      <div class="modal-bar"></div>
      <div class="modal-header">
        <h2>è¨­å®š</h2>
        <button class="modal-close" data-close="settingsModal">Ã—</button>
      </div>
      <div class="modal-body">
        <button class="btn btn-danger" id="resetBtn">ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
        <p class="settings-hint">èª­æ›¸è¨˜éŒ²ãƒ»XPãƒ»ç™»éŒ²ã—ãŸæœ¬ãŒã™ã¹ã¦å‰Šé™¤ã•ã‚Œã¾ã™</p>
      </div>
    </div>
  </div>

  <!-- ãƒªã‚»ãƒƒãƒˆç¢ºèª -->

  <div class="confirm-overlay" id="resetConfirm">
    <div class="confirm-box">
      <div class="confirm-icon">âš ï¸</div>
      <div class="confirm-title">ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ</div>
      <div class="confirm-text">ã™ã¹ã¦ã®è¨˜éŒ²ãŒå‰Šé™¤ã•ã‚Œã¾ã™ã€‚ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚</div>
      <div class="confirm-btns">
        <button class="confirm-cancel" data-close="resetConfirm">ã„ã„ãˆ</button>
        <button class="confirm-ok" id="confirmResetBtn">ã¯ã„</button>
      </div>
    </div>
  </div>

  <!-- æœ¬å‰Šé™¤ç¢ºèª -->

  <div class="confirm-overlay" id="deleteConfirm">
    <div class="confirm-box">
      <div class="confirm-icon">ğŸ“•</div>
      <div class="confirm-title" id="deleteBookTitle">ã€Œã€</div>
      <div class="confirm-text">å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ</div>
      <div class="confirm-btns">
        <button class="confirm-cancel" data-close="deleteConfirm">ã„ã„ãˆ</button>
        <button class="confirm-ok" id="confirmDeleteBtn">ã¯ã„</button>
      </div>
    </div>
  </div>

  <!-- ãƒªãƒ³ã‚¯ç¢ºèª -->

  <div class="confirm-overlay" id="linkConfirm">
    <div class="confirm-box">
      <div class="confirm-icon">ğŸ”—</div>
      <div class="confirm-title">å¤–éƒ¨ãƒªãƒ³ã‚¯ã‚’é–‹ã</div>
      <div class="confirm-text" id="linkConfirmUrl"></div>
      <div class="confirm-btns">
        <button class="confirm-cancel" data-close="linkConfirm">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button class="confirm-ok link" id="confirmLinkBtn">é–‹ã</button>
      </div>
    </div>
  </div>

  <!-- ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ— -->

  <div class="levelup-overlay" id="levelupOverlay">
    <div class="levelup-content">
      <div class="levelup-icon">â¬†ï¸</div>
      <div class="levelup-label">LEVEL UP</div>
      <div class="levelup-value" id="newLevel">Lv.2</div>
      <button class="levelup-btn" id="closeLevelup">ã‚¿ãƒƒãƒ—ã—ã¦é–‰ã˜ã‚‹</button>
    </div>
  </div>

  <!-- ç§°å·ç²å¾— -->

  <div class="levelup-overlay" id="titleOverlay">
    <div class="levelup-content">
      <div class="levelup-icon" id="newTitleIcon">ğŸ“–</div>
      <div class="levelup-label">NEW TITLE</div>
      <div class="levelup-value" id="newTitleName">æœ¬ã®è™«</div>
      <div class="levelup-sub" id="newTitleSub">å°‘ã—ãšã¤ç¿’æ…£ã«</div>
      <button class="levelup-btn" id="closeTitle">ã‚¿ãƒƒãƒ—ã—ã¦é–‰ã˜ã‚‹</button>
    </div>
  </div>

<script>
// ========================================
// å®šæ•°
// ========================================
const STORAGE_KEY = 'readingLogV4';
const XP_PER_LEVEL = 5;
const XP_PER_BOOK = 10;
const MIN_SESSION_MINUTES = 10;

const TITLES = [
  { lv: 1, name: 'èª­æ›¸ãƒ“ã‚®ãƒŠãƒ¼', sub: 'èª­æ›¸ã®æ—…ãŒå§‹ã¾ã‚‹', icon: 'ğŸŒ±' },
  { lv: 3, name: 'æœ¬ã®è™«', sub: 'å°‘ã—ãšã¤ç¿’æ…£ã«', icon: 'ğŸ›' },
  { lv: 5, name: 'èª­æ›¸å®¶', sub: 'èª­æ›¸ãŒæ—¥å¸¸ã«ãªã£ãŸ', icon: 'ğŸ“–' },
  { lv: 10, name: 'èª­æ›¸ãƒãƒ‹ã‚¢', sub: 'æœ¬ãªã—ã§ã¯ç”Ÿãã‚‰ã‚Œãªã„', icon: 'ğŸ“š' },
  { lv: 20, name: 'èª­æ›¸ãƒã‚¹ã‚¿ãƒ¼', sub: 'çŸ¥è­˜ã®æ¢æ±‚è€…', icon: 'ğŸ“' },
  { lv: 35, name: 'èª­æ›¸ã®é”äºº', sub: 'æœ¬ã¨å…±ã«ç”Ÿãã‚‹', icon: 'âš”ï¸' },
  { lv: 50, name: 'èª­æ›¸ç‹', sub: 'æ›¸ç‰©ã®ç‹å›½ã®ä¸»', icon: 'ğŸ‘‘' },
  { lv: 75, name: 'èª­æ›¸ã®è³¢è€…', sub: 'ç„¡é™ã®çŸ¥æµ', icon: 'ğŸ§™' },
  { lv: 100, name: 'èª­æ›¸ç¥', sub: 'ç¥ã®é ˜åŸŸã¸', icon: 'âœ¨' }
];

const QUOTES = [
  { text: 'èª­æ›¸ã¯å¿ƒã®æ—…è·¯ã€‚ä¸€ãƒšãƒ¼ã‚¸ãŒæ–°ã—ã„ä¸–ç•Œã¸ã®æ‰‰ã¨ãªã‚‹ã€‚', author: 'ä»Šæ—¥ã®ä¸€è¨€' },
  { text: 'æœ¬ã‚’èª­ã‚€ã“ã¨ã¯ã€ä»–äººã®é ­ã§è€ƒãˆã‚‹ã“ã¨ã§ã‚ã‚‹ã€‚', author: 'ã‚·ãƒ§ãƒ¼ãƒšãƒ³ãƒã‚¦ã‚¢ãƒ¼' },
  { text: 'è‰¯æ›¸ã¯æœ€è‰¯ã®å‹äººã§ã‚ã‚‹ã€‚', author: 'ãƒ—ãƒ­ãƒ´ã‚¡ãƒ¼ãƒ–' },
  { text: 'çŸ¥è­˜ã¸ã®æŠ•è³‡ã¯ã€å¸¸ã«æœ€é«˜ã®åˆ©æ¯ãŒã¤ãã€‚', author: 'ãƒ™ãƒ³ã‚¸ãƒ£ãƒŸãƒ³ãƒ»ãƒ•ãƒ©ãƒ³ã‚¯ãƒªãƒ³' },
  { text: 'æœ¬ã¯å¿ƒã®ç³§ã€‚æ¯æ—¥å°‘ã—ãšã¤å‘³ã‚ãŠã†ã€‚', author: 'ä»Šæ—¥ã®ä¸€è¨€' }
];

const BOOK_COLORS = [
  '#c62828', '#1565c0', '#2e7d32', '#6a1b9a', '#e65100',
  '#00695c', '#37474f', '#8d6e63', '#d84315', '#0277bd'
];

// ========================================
// çŠ¶æ…‹
// ========================================
let state = loadState();
let timer = null;
let seconds = 0;
let deletingBookId = null;
let editingBookId = null;

function createInitialState() {
  return {
    total: 0,
    today: 0,
    date: new Date().toDateString(),
    sessions: 0,
    xp: 0,
    lv: 1,
    books: [],
    history: [],
    milestones: []
  };
}

function loadState() {
  try {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
      const parsed = JSON.parse(saved);
      if (parsed.date !== new Date().toDateString()) {
        parsed.today = 0;
        parsed.date = new Date().toDateString();
      }
      return parsed;
    }
  } catch (e) {}
  return createInitialState();
}

function saveState() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

// ========================================
// ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
// ========================================
function getTitle(level) {
  for (let i = TITLES.length - 1; i >= 0; i--) {
    if (level >= TITLES[i].lv) return TITLES[i];
  }
  return TITLES[0];
}

function formatTime(minutes) {
  const h = Math.floor(minutes / 60);
  const m = minutes % 60;
  return `${h}:${m.toString().padStart(2, '0')}`;
}

function escapeHtml(str) {
  const div = document.createElement('div');
  div.textContent = str;
  return div.innerHTML;
}

function isValidUrl(str) {
  return str && /^https?:\/\//i.test(str);
}

function isAmazonShortUrl(url) {
  if (!url) return false;
  // amzn.asia/d/XXX ã‚„ amzn.to/XXX ãªã©ã®çŸ­ç¸®URLã‚’æ¤œå‡º
  return /^https?:\/\/(amzn\.asia|amzn\.to)\//i.test(url);
}

function extractAsinFromUrl(url) {
  if (!url) return null;
  // Amazonã®æ§˜ã€…ãªURLãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰ASINã‚’æŠ½å‡º
  // /dp/ASIN, /gp/product/ASIN, /gp/aw/d/ASIN ãªã©
  const patterns = [
    /\/dp\/([A-Z0-9]{10})/i,
    /\/gp\/product\/([A-Z0-9]{10})/i,
    /\/gp\/aw\/d\/([A-Z0-9]{10})/i,
    /\/ASIN\/([A-Z0-9]{10})/i,
    /amazon\.[a-z.]+\/.*?\/([A-Z0-9]{10})(?:[/?]|$)/i
  ];

  for (const pattern of patterns) {
    const match = url.match(pattern);
    if (match) return match[1];
  }
  return null;
}

function getAmazonImageUrl(asin) {
  if (!asin) return null;
  // Amazon Product Images API (å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ç”»åƒURLå½¢å¼)
  return `https://images-na.ssl-images-amazon.com/images/P/${asin}.09.LZZZZZZZ.jpg`;
}

function adjustColor(hex, amount) {
  const num = parseInt(hex.slice(1), 16);
  const r = Math.min(255, Math.max(0, (num >> 16) + amount));
  const g = Math.min(255, Math.max(0, ((num >> 8) & 0x00FF) + amount));
  const b = Math.min(255, Math.max(0, (num & 0x0000FF) + amount));
  return `#${((r << 16) | (g << 8) | b).toString(16).padStart(6, '0')}`;
}

function calculateStreak(history) {
  if (!history.length) return 0;

  const today = new Date();
  today.setHours(0, 0, 0, 0);

  // æ—¥ä»˜ã”ã¨ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
  const readingDays = new Set(
    history.map(h => new Date(h.d).toDateString())
  );

  let streak = 0;
  const checkDate = new Date(today);

  // ä»Šæ—¥èª­ã‚“ã§ã„ãªã„å ´åˆã¯æ˜¨æ—¥ã‹ã‚‰ã‚«ã‚¦ãƒ³ãƒˆé–‹å§‹
  if (!readingDays.has(today.toDateString())) {
    checkDate.setDate(checkDate.getDate() - 1);
  }

  while (readingDays.has(checkDate.toDateString())) {
    streak++;
    checkDate.setDate(checkDate.getDate() - 1);
  }

  return streak;
}

function calculateYearlyPrediction(books, history) {
  if (!books.length || !history.length) return '--å†Š';

  const now = new Date();
  const firstSession = new Date(history[0].d);
  const daysSinceStart = Math.max(1, Math.ceil((now - firstSession) / 86400000));

  // 1æ—¥ã‚ãŸã‚Šã®èª­äº†ãƒšãƒ¼ã‚¹
  const booksPerDay = books.length / daysSinceStart;

  // ä»Šå¹´ã®æ®‹ã‚Šæ—¥æ•°
  const endOfYear = new Date(now.getFullYear(), 11, 31);
  const daysLeft = Math.ceil((endOfYear - now) / 86400000);

  // ä»Šå¹´èª­ã‚ã‚‹äºˆæ¸¬å†Šæ•°
  const prediction = books.length + Math.round(booksPerDay * daysLeft);

  return prediction + 'å†Š';
}

function getNextTitleInfo(level, xp) {
  const currentTitle = getTitle(level);
  const nextTitle = TITLES.find(t => t.lv > level);

  if (!nextTitle) {
    return { text: 'æœ€é«˜ä½åˆ°é”ï¼', label: 'å…¨ç§°å·ç²å¾—æ¸ˆã¿' };
  }

  const xpNeeded = (nextTitle.lv - 1) * XP_PER_LEVEL - xp;
  const booksNeeded = Math.ceil(xpNeeded / XP_PER_BOOK);

  return {
    text: nextTitle.name,
    label: `ã‚ã¨${booksNeeded}å†Šã§ç²å¾—`
  };
}

// ========================================
// ãƒªãƒ³ã‚¯ç¢ºèª
// ========================================
let pendingLink = null;

function openLink(url, event) {
  if (event) event.preventDefault();
  window.open(url, '_blank');
}

function confirmOpenLink() {
  if (pendingLink) {
    window.open(pendingLink, '_blank');
    pendingLink = null;
  }
  closeModal('linkConfirm');
}

// ========================================
// UIæ›´æ–°
// ========================================

// æ™‚é–“å¸¯ã¨çŠ¶æ…‹ã«å¿œã˜ãŸã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
const BUTTON_ANIMATIONS = {
  morning: [
    { icon: 'ğŸ“–', anim: 'page-flip', label: 'æœ¬ã‚’ã‚ãã£ã¦æœã®ã‚¹ã‚¿ãƒ¼ãƒˆ' },
    { icon: 'âœ¨', anim: 'sparkle', label: 'æ–°ã—ã„1æ—¥ã‚’è¼ã‹ã›ã‚ˆã†' },
    { icon: 'ğŸŒ…', anim: 'float', label: 'æœæ—¥ã¨å…±ã«èª­æ›¸ã‚’' }
  ],
  afternoon: [
    { icon: 'ğŸ“–', anim: 'bounce', label: 'åˆå¾Œã®èª­æ›¸ã‚¿ã‚¤ãƒ ' },
    { icon: 'â˜€ï¸', anim: 'wave', label: 'æ˜¼ä¸‹ãŒã‚Šã®ä¸€å†Š' },
    { icon: 'ğŸ“š', anim: 'page-flip', label: 'æœ¬ã®ä¸–ç•Œã¸é£›ã³è¾¼ã‚‚ã†' }
  ],
  evening: [
    { icon: 'ğŸŒ™', anim: 'relax', label: 'ãƒªãƒ©ãƒƒã‚¯ã‚¹ã—ã¦èª­æ›¸ã‚’' },
    { icon: 'ğŸ“–', anim: 'float', label: 'ã‚†ã£ãŸã‚Šèª­æ›¸ã‚¿ã‚¤ãƒ ' },
    { icon: 'âœ¨', anim: 'sparkle', label: 'å¤œã®ã²ã¨ã¨ãã‚’æœ¬ã¨å…±ã«' }
  ],
  night: [
    { icon: 'ğŸŒƒ', anim: 'relax', label: 'é™ã‹ãªå¤œã®èª­æ›¸' },
    { icon: 'ğŸ“–', anim: 'float', label: 'ã‚†ã£ãã‚Šã¨æœ¬ã®ä¸–ç•Œã¸' },
    { icon: 'ğŸŒ™', anim: 'relax', label: 'ç©ã‚„ã‹ãªèª­æ›¸ã‚¿ã‚¤ãƒ ' }
  ],
  streak: [
    { icon: 'ğŸ”¥', anim: 'flame', label: 'é€£ç¶šè¨˜éŒ²ã‚’ä¼¸ã°ãã†ï¼' },
    { icon: 'âš¡', anim: 'sparkle', label: 'å‹¢ã„ã«ä¹—ã£ã¦èª­æ›¸ï¼' }
  ]
};

function getButtonAnimation() {
  const hour = new Date().getHours();
  const streak = calculateStreak(state.history);

  // é€£ç¶šè¨˜éŒ²ãŒ3æ—¥ä»¥ä¸Šã‚ã‚Œã°ã€ãŸã¾ã«ç‚ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
  if (streak >= 3 && Math.random() < 0.3) {
    const options = BUTTON_ANIMATIONS.streak;
    return options[Math.floor(Math.random() * options.length)];
  }

  // æ™‚é–“å¸¯ã«å¿œã˜ãŸã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
  let timeSlot;
  if (hour >= 5 && hour < 12) {
    timeSlot = 'morning';
  } else if (hour >= 12 && hour < 17) {
    timeSlot = 'afternoon';
  } else if (hour >= 17 && hour < 21) {
    timeSlot = 'evening';
  } else {
    timeSlot = 'night';
  }

  const options = BUTTON_ANIMATIONS[timeSlot];
  return options[Math.floor(Math.random() * options.length)];
}

function updateButtonAnimation() {
  const btnIcon = document.querySelector('#startBtn .main-btn-icon');
  if (!btnIcon) return;

  const config = getButtonAnimation();

  // ã‚¢ã‚¤ã‚³ãƒ³ã‚’æ›´æ–°
  btnIcon.textContent = config.icon;

  // æ—¢å­˜ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
  btnIcon.className = 'main-btn-icon';

  // æ–°ã—ã„ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
  btnIcon.classList.add(`anim-${config.anim}`);

}

function updateUI() {
  // å¼•ç”¨ã‚’æ›´æ–°
  const quote = QUOTES[Math.floor(Math.random() * QUOTES.length)];
  document.getElementById('quoteText').textContent = quote.text;
  document.getElementById('quoteAuthor').textContent = `â€” ${quote.author}`;

  // ãƒœã‚¿ãƒ³ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ›´æ–°
  updateButtonAnimation();

  saveState();
}

// ========================================
// ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
// ========================================
function switchTab(name) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));
  
  document.getElementById(`tab-${name}`).classList.add('active');
  document.querySelector(`.nav button[data-tab="${name}"]`).classList.add('active');
  
  if (name === 'books') renderBooks();
  if (name === 'stats') renderStats();
}

// ========================================
// èª­æ›¸ä¸­ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆè½ã¡ç€ã„ãŸç³»ï¼‰
// ========================================
const READING_ANIMATIONS = [
  { icon: 'ğŸ“–', anim: 'breath', label: 'èª­æ›¸ã«é›†ä¸­ã—ã¦ã„ã¾ã™' },
  { icon: 'ğŸŒ™', anim: 'float', label: 'ã‚†ã£ãŸã‚Šã¨èª­æ›¸ä¸­' },
  { icon: 'â˜ï¸', anim: 'sway', label: 'ç©ã‚„ã‹ã«èª­æ›¸ä¸­' },
  { icon: 'ğŸƒ', anim: 'zen', label: 'é™ã‹ã«èª­æ›¸ä¸­' },
  { icon: 'âœ¨', anim: 'breath', label: 'æœ¬ã®ä¸–ç•Œã«æµ¸ã£ã¦ã„ã¾ã™' },
  { icon: 'ğŸŒ¿', anim: 'float', label: 'ãƒªãƒ©ãƒƒã‚¯ã‚¹ã—ã¦èª­æ›¸ä¸­' }
];

function getReadingAnimation() {
  return READING_ANIMATIONS[Math.floor(Math.random() * READING_ANIMATIONS.length)];
}

function applyReadingAnimation() {
  const config = getReadingAnimation();
  const animEl = document.getElementById('readingAnim');
  const iconEl = document.getElementById('readingIcon');
  const labelEl = document.getElementById('readingLabel');

  // ã‚¢ã‚¤ã‚³ãƒ³ã‚’æ›´æ–°
  iconEl.textContent = config.icon;

  // æ—¢å­˜ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
  animEl.className = 'reading-anim';

  // æ–°ã—ã„ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
  animEl.classList.add(`anim-${config.anim}`);

  // ãƒ©ãƒ™ãƒ«ã‚’æ›´æ–°
  labelEl.textContent = config.label;
}

// ========================================
// ã‚¿ã‚¤ãƒãƒ¼
// ========================================
function startReading() {
  seconds = 0;
  applyReadingAnimation();
  document.getElementById('readingScreen').classList.add('active');
  timer = setInterval(() => seconds++, 1000);
  document.getElementById('startBtn').innerHTML = '<span class="main-btn-icon anim-relax">ğŸ“–</span><span>èª­æ›¸ä¸­...</span>';
}

function stopReading() {
  clearInterval(timer);
  timer = null;
  document.getElementById('readingScreen').classList.remove('active');
  
  const minutes = Math.floor(seconds / 60);
  state.total += minutes;
  state.today += minutes;
  
  if (minutes >= MIN_SESSION_MINUTES) {
    state.sessions++;
    state.history.push({
      d: new Date().toISOString(),
      m: minutes,
      h: new Date().getHours()
    });
    addXP(1 + Math.floor(minutes / 10));
  }
  
  // ã‚¢ã‚¤ã‚³ãƒ³ã‚’ä¸€æ™‚çš„ã«ãƒªã‚»ãƒƒãƒˆï¼ˆupdateUIã§æ­£ã—ã„ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒè¨­å®šã•ã‚Œã‚‹ï¼‰
  document.getElementById('startBtn').innerHTML = '<span class="main-btn-icon">ğŸ“–</span><span>èª­æ›¸ã‚’ã¯ã˜ã‚ã‚‹</span>';
  seconds = 0;
  updateUI();
}

// ========================================
// XPãƒ»ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—
// ========================================
function addXP(amount) {
  const oldLevel = state.lv;
  state.xp += amount;
  state.lv = Math.floor(state.xp / XP_PER_LEVEL) + 1;
  
  if (state.lv > oldLevel) {
    document.getElementById('newLevel').textContent = `Lv.${state.lv}`;
    document.getElementById('levelupOverlay').classList.add('active');
    showConfetti();
    
    const oldTitle = getTitle(oldLevel);
    const newTitle = getTitle(state.lv);
    if (newTitle.name !== oldTitle.name) {
      setTimeout(() => {
        document.getElementById('newTitleIcon').textContent = newTitle.icon;
        document.getElementById('newTitleName').textContent = newTitle.name;
        document.getElementById('newTitleSub').textContent = newTitle.sub;
        document.getElementById('titleOverlay').classList.add('active');
      }, 2000);
    }
  }
}

// ========================================
// æœ¬æ£š
// ========================================
function renderBooks() {
  const bookCount = state.books.length;
  document.getElementById('bookCount').textContent = bookCount;

  const shelf = document.getElementById('shelf');
  const bookList = document.getElementById('bookList');
  const booksSummary = document.getElementById('booksSummary');
  const booksListTitle = document.getElementById('booksListTitle');
  const booksListHint = document.getElementById('booksListHint');
  const booksTip = document.getElementById('booksTip');
  const booksTipText = document.getElementById('booksTipText');

  if (!bookCount) {
    shelf.innerHTML = `
      <div class="empty-shelf">
        <div class="empty-shelf-icon">ğŸ“–</div>
        <div class="empty-shelf-text">ã¾ã æœ¬ãŒã‚ã‚Šã¾ã›ã‚“</div>
        <div class="empty-shelf-hint">èª­ã¿çµ‚ãˆãŸæœ¬ã‚’è¨˜éŒ²ã—ã¦ã¿ã¾ã—ã‚‡ã†</div>
      </div>`;
    bookList.innerHTML = '';
    booksSummary.classList.remove('has-books');
    booksListTitle.style.display = 'none';
    booksListHint.classList.remove('visible');
    booksTipText.textContent = 'å³ä¸‹ã® + ãƒœã‚¿ãƒ³ã‹ã‚‰èª­äº†ã‚’è¨˜éŒ²ã§ãã¾ã™';
    return;
  }

  // çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã®è¨ˆç®—
  const booksWithXP = state.books.filter(b => b.xp).length;
  const recentBooks = state.books.filter(b => {
    const bookDate = new Date(b.id);
    const now = new Date();
    const thirtyDaysAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
    return bookDate >= thirtyDaysAgo;
  }).length;

  // ã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤º
  booksSummary.classList.add('has-books');
  booksSummary.innerHTML = `
    <div class="books-summary-card books-summary-card-recent">
      <div class="books-summary-icon">ğŸ“…</div>
      <div class="books-summary-value">${recentBooks}å†Š</div>
      <div class="books-summary-label">ä»Šæœˆã®èª­äº†</div>
    </div>
    <div class="books-summary-card books-summary-card-xp">
      <div class="books-summary-icon">âœ¨</div>
      <div class="books-summary-value">+${booksWithXP * 10} XP</div>
      <div class="books-summary-label">ç²å¾—ã—ãŸXP</div>
    </div>
  `;

  // ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒˆãƒ«ã¨ãƒ’ãƒ³ãƒˆè¡¨ç¤º
  booksListTitle.style.display = 'block';
  booksListHint.classList.add('visible');

  // ãƒ’ãƒ³ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  const tips = [
    'Amazon URLã‚’ç™»éŒ²ã™ã‚‹ã¨è¡¨ç´™ãŒè‡ªå‹•è¡¨ç¤ºã•ã‚Œã¾ã™',
    'æœ¬æ£šã®æœ¬ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨è©³ç´°ãŒè¦‹ã‚Œã¾ã™',
    'èª­æ›¸ã‚’ç¶šã‘ã¦ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ã—ã‚ˆã†',
    'ã‚ãªãŸã®èª­æ›¸ãƒšãƒ¼ã‚¹ã€ç´ æ™´ã‚‰ã—ã„ã§ã™'
  ];
  booksTipText.textContent = tips[bookCount % tips.length];

  shelf.innerHTML = state.books.map((book, i) => {
    const color = BOOK_COLORS[i % BOOK_COLORS.length];
    // æœ¬ã®é«˜ã•ã¨å¹…ã‚’ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³è±Šã‹ã«
    const height = 50 + ((i * 17) % 25);
    const width = book.coverUrl ? 18 + ((i * 2) % 6) : 14 + ((i * 3) % 8);
    // å°‘ã—å‚¾ãã‚’åŠ ãˆã‚‹
    const tilt = ((i * 7) % 5) - 2;
    const hasLink = isValidUrl(book.link);
    const linkBtn = hasLink
      ? `<button class="tooltip-btn" onclick="openLink('${escapeHtml(book.link)}', event)">ãƒªãƒ³ã‚¯ã‚’é–‹ã</button>`
      : '';
    // æœ¬ã”ã¨ã«å°‘ã—ç•°ãªã‚‹è‰²åˆã„ã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    const darkerColor = adjustColor(color, -20);
    const lighterColor = adjustColor(color, 15);

    // è¡¨ç´™ç”»åƒãŒã‚ã‚Œã°èƒŒæ™¯ã«ä½¿ç”¨
    const bgStyle = book.coverUrl
      ? `background-image: url('${escapeHtml(book.coverUrl)}'); background-size: cover; background-position: center;`
      : `background: linear-gradient(to right, ${lighterColor} 0%, ${color} 15%, ${color} 85%, ${darkerColor} 100%);`;
    const hasCoverClass = book.coverUrl ? 'has-cover' : '';

    return `
      <div class="mini-book ${hasCoverClass}" style="
        height:${height}px;
        width:${width}px;
        ${bgStyle}
        transform: rotate(${tilt}deg);
      ">
        <div class="book-tooltip">
          <div class="tooltip-title">${escapeHtml(book.title)}</div>
          ${linkBtn}
        </div>
      </div>`;
  }).join('');
  
  bookList.innerHTML = [...state.books].reverse().map(book => {
    const link = isValidUrl(book.link) ? escapeHtml(book.link) : null;
    const xpBadge = book.xp ? '<span class="book-xp">+10 XP</span>' : '';
    const linkBtn = link
      ? `<button onclick="openLink('${link}', event)">â†—</button>`
      : '';

    // è¡¨ç´™ç”»åƒãŒã‚ã‚Œã°è¡¨ç¤ºã€ãªã‘ã‚Œã°çµµæ–‡å­—ã‚¢ã‚¤ã‚³ãƒ³
    const coverHtml = book.coverUrl
      ? `<img src="${escapeHtml(book.coverUrl)}" alt="" class="book-cover" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'"><div class="book-icon-fallback">ğŸ“•</div>`
      : '<div class="book-icon-emoji">ğŸ“•</div>';

    return `
      <div class="book-item">
        <div class="book-icon">${coverHtml}</div>
        <div class="book-info">
          <div class="book-name">${escapeHtml(book.title)}</div>
          <div class="book-date">${new Date(book.id).toLocaleDateString('ja-JP')}${xpBadge}</div>
        </div>
        <div class="book-actions">
          ${linkBtn}
          <button onclick="editBook(${book.id})">âœï¸</button>
          <button onclick="deleteBook(${book.id})">Ã—</button>
        </div>
      </div>
    `;
  }).join('');
}

function addBook(withXP) {
  const title = document.getElementById('bookInput').value.trim();
  if (!title) {
    showToast('ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
    return;
  }

  const link = document.getElementById('linkInput').value.trim();

  // Amazonãƒªãƒ³ã‚¯ã‹ã‚‰è¡¨ç´™ç”»åƒURLã‚’è‡ªå‹•ç”Ÿæˆ
  let coverUrl = null;
  const asin = extractAsinFromUrl(link);
  if (asin) {
    coverUrl = getAmazonImageUrl(asin);
  } else if (isAmazonShortUrl(link)) {
    // çŸ­ç¸®URLã®å ´åˆã¯è­¦å‘Šã‚’è¡¨ç¤º
    showToast('çŸ­ç¸®URL(amzn.asiaç­‰)ã§ã¯è¡¨ç´™ç”»åƒã‚’å–å¾—ã§ãã¾ã›ã‚“ã€‚amazon.co.jpã®ãƒ•ãƒ«URLã‚’ãŠä½¿ã„ãã ã•ã„', 4000);
  }

  state.books.push({
    id: Date.now(),
    title,
    link: link || null,
    coverUrl: coverUrl,
    xp: withXP
  });
  
  if (withXP) {
    addXP(XP_PER_BOOK);
    showConfetti();
    showToast('1å†Šèª­ç ´ï¼+10 XP');
  } else {
    showToast('æœ¬ã‚’ç™»éŒ²ã—ã¾ã—ãŸ');
  }
  
  renderBooks();
  updateUI();
  closeModal('addBookModal');
  document.getElementById('bookInput').value = '';
  document.getElementById('linkInput').value = '';
}

function editBook(id) {
  const book = state.books.find(b => b.id === id);
  if (!book) return;
  
  editingBookId = id;
  document.getElementById('editBookTitle').value = book.title;
  document.getElementById('editBookLink').value = book.link || '';
  document.getElementById('editBookModal').classList.add('active');
}

function saveEditBook() {
  const title = document.getElementById('editBookTitle').value.trim();
  if (!title) {
    showToast('ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
    return;
  }

  const book = state.books.find(b => b.id === editingBookId);
  if (book) {
    book.title = title;
    const newLink = document.getElementById('editBookLink').value.trim() || null;

    // ãƒªãƒ³ã‚¯ãŒå¤‰ã‚ã£ãŸå ´åˆã€è¡¨ç´™ç”»åƒã‚’å†å–å¾—
    if (newLink !== book.link) {
      book.link = newLink;
      const asin = extractAsinFromUrl(newLink);
      book.coverUrl = asin ? getAmazonImageUrl(asin) : null;

      // çŸ­ç¸®URLã®å ´åˆã¯è­¦å‘Šã‚’è¡¨ç¤º
      if (!asin && isAmazonShortUrl(newLink)) {
        showToast('çŸ­ç¸®URL(amzn.asiaç­‰)ã§ã¯è¡¨ç´™ç”»åƒã‚’å–å¾—ã§ãã¾ã›ã‚“ã€‚amazon.co.jpã®ãƒ•ãƒ«URLã‚’ãŠä½¿ã„ãã ã•ã„', 4000);
      }
    }

    saveState();
    renderBooks();
    showToast('ä¿å­˜ã—ã¾ã—ãŸ');
  }
  closeModal('editBookModal');
}

function deleteBook(id) {
  const book = state.books.find(b => b.id === id);
  if (!book) return;
  
  deletingBookId = id;
  document.getElementById('deleteBookTitle').textContent = `ã€Œ${book.title}ã€`;
  document.getElementById('deleteConfirm').classList.add('active');
}

function confirmDeleteBook() {
  const book = state.books.find(b => b.id === deletingBookId);
  if (book?.xp) {
    state.xp = Math.max(0, state.xp - XP_PER_BOOK);
    state.lv = Math.floor(state.xp / XP_PER_LEVEL) + 1;
  }
  state.books = state.books.filter(b => b.id !== deletingBookId);
  
  saveState();
  renderBooks();
  updateUI();
  showToast('å‰Šé™¤ã—ã¾ã—ãŸ');
  closeModal('deleteConfirm');
}

// ========================================
// çµ±è¨ˆ
// ========================================
function renderStats() {
  // çµŒé¨“å€¤ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ã‚µãƒ¼ã‚¯ãƒ«
  const title = getTitle(state.lv);
  document.getElementById('levelDisplay').textContent = `Lv.${state.lv}`;
  document.getElementById('titleDisplay').textContent = title.name;

  const xpInLevel = state.xp % XP_PER_LEVEL;
  document.getElementById('xpProgress').textContent = xpInLevel;
  document.getElementById('xpNeeded').textContent = XP_PER_LEVEL;

  // ãƒªãƒ³ã‚°ã®é€²æ—ã‚’æ›´æ–°ï¼ˆå††å‘¨ã¯2Ï€r â‰ˆ 414.69ï¼‰
  const circumference = 414.69;
  const progress = xpInLevel / XP_PER_LEVEL;
  const offset = circumference * (1 - progress);
  document.getElementById('xpRing').style.strokeDashoffset = offset;

  document.getElementById('totalHours').textContent = Math.floor(state.total / 60);
  document.getElementById('totalSessions').textContent = state.sessions;
  
  const days = state.history.length 
    ? Math.max(1, Math.ceil((Date.now() - new Date(state.history[0].d)) / 86400000)) 
    : 1;
  document.getElementById('daysSince').textContent = days;
  
  // é€±é–“ãƒãƒ£ãƒ¼ãƒˆ
  const dayNames = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
  const now = new Date();
  const data = [];
  let max = 30;
  
  for (let i = 6; i >= 0; i--) {
    const date = new Date(now);
    date.setDate(date.getDate() - i);
    const dateStr = date.toISOString().split('T')[0];
    const minutes = state.history
      .filter(h => h.d.startsWith(dateStr))
      .reduce((sum, h) => sum + h.m, 0);
    max = Math.max(max, minutes);
    data.push({
      label: dayNames[date.getDay()],
      minutes,
      isToday: i === 0
    });
  }
  
  document.getElementById('weekChart').innerHTML = data.map(d => {
    const height = d.minutes ? Math.max(8, Math.round(d.minutes / max * 60)) : 4;
    return `
      <div class="week-bar${d.isToday ? ' today' : ''}">
        <div class="week-bar-fill${d.minutes ? '' : ' empty'}" style="height:${height}px"></div>
        <span>${d.label}</span>
      </div>
    `;
  }).join('');

  // å¹´é–“èª­æ›¸äºˆæ¸¬
  const yearlyPrediction = calculateYearlyPrediction(state.books, state.history);
  document.getElementById('yearlyPrediction').textContent = yearlyPrediction;

  // æ¬¡ã®ç§°å·ã¾ã§
  const nextTitleInfo = getNextTitleInfo(state.lv, state.xp);
  document.getElementById('nextTitle').textContent = nextTitleInfo.text;
  document.getElementById('nextTitleLabel').textContent = nextTitleInfo.label;

  // ã‚¹ã‚¿ã‚¤ãƒ«
  const history = state.history;
  document.getElementById('avgFocus').textContent = history.length 
    ? Math.round(history.reduce((sum, h) => sum + h.m, 0) / history.length) + 'åˆ†' 
    : '--';
  
  if (history.length >= 3) {
    const hours = history.map(h => h.h);
    const counts = [
      hours.filter(h => h >= 5 && h < 12).length,
      hours.filter(h => h >= 12 && h < 18).length,
      hours.filter(h => h >= 18 && h < 22).length,
      hours.filter(h => h >= 22 || h < 5).length
    ];
    const maxIndex = counts.indexOf(Math.max(...counts));
    const types = [['æœå‹', 'ğŸŒ…'], ['æ˜¼å‹', 'â˜€ï¸'], ['å¤œå‹', 'ğŸŒ™'], ['æ·±å¤œå‹', 'ğŸŒƒ']];
    document.getElementById('timeType').textContent = types[maxIndex][0];
    document.getElementById('timeIcon').textContent = types[maxIndex][1];
  }
  
  // ãƒ’ãƒ³ãƒˆ
  const tips = [];
  if (state.books.length > 0 && state.total > 0) {
    tips.push(`å¹³å‡1å†Šã‚ãŸã‚Š${Math.round(state.total / state.books.length)}åˆ†`);
  }
  if (state.total >= 60) tips.push(`åˆè¨ˆ${Math.floor(state.total / 60)}æ™‚é–“èª­æ›¸`);
  if (state.total >= 120) tips.push(`æ˜ ç”»${Math.floor(state.total / 120)}æœ¬åˆ†ã®æ™‚é–“`);
  
  document.getElementById('tipText').textContent = tips.length 
    ? tips[Math.floor(Math.random() * tips.length)] 
    : 'èª­æ›¸ã‚’å§‹ã‚ã¦è¨˜éŒ²ã‚’ä½œã‚ã†';
}

// ========================================
// ãƒ¢ãƒ¼ãƒ€ãƒ«
// ========================================
function closeModal(id) {
  document.getElementById(id).classList.remove('active');
}

// ========================================
// ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
// ========================================
function showToast(message) {
  const toast = document.createElement('div');
  toast.className = 'toast';
  toast.textContent = message;
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 3000);
}

function showConfetti() {
  const container = document.createElement('div');
  container.className = 'confetti';
  const colors = ['#e8a87c', '#f0c27b', '#7dd3a8', '#6b5b95', '#f87171'];
  
  for (let i = 0; i < 40; i++) {
    const piece = document.createElement('i');
    piece.style.cssText = `
      left: ${Math.random() * 100}%;
      background: ${colors[i % 5]};
      animation-delay: ${Math.random() * 0.4}s;
      animation-duration: ${2 + Math.random()}s;
    `;
    container.appendChild(piece);
  }
  
  document.body.appendChild(container);
  setTimeout(() => container.remove(), 3000);
}

// ========================================
// ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
// ========================================
document.querySelectorAll('.nav button').forEach(btn => {
  btn.addEventListener('click', () => switchTab(btn.dataset.tab));
});

document.getElementById('startBtn').addEventListener('click', () => {
  timer ? stopReading() : startReading();
});

document.getElementById('stopBtn').addEventListener('click', stopReading);

document.getElementById('settingsBtn').addEventListener('click', () => {
  document.getElementById('settingsModal').classList.add('active');
});

document.querySelector('.nav button[data-tab="books"]').addEventListener('click', () => {
  // æœ¬æ£šã‚¿ãƒ–ã«åˆ‡ã‚Šæ›¿ãˆæ™‚ã€ãƒ˜ãƒƒãƒ€ãƒ¼ã«+ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹ä»£ã‚ã‚Šã«ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ããƒœã‚¿ãƒ³ã‚’è¿½åŠ 
});

// æœ¬è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ« - æœ¬æ£šã‚¿ãƒ–ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¯ãƒªãƒƒã‚¯ã§é–‹ã
document.addEventListener('click', (e) => {
  if (e.target.closest('.header-btn.primary') || 
      (e.target.closest('.header') && document.getElementById('tab-books').classList.contains('active'))) {
    // æœ¬æ£šã‚¿ãƒ–ã§ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´åˆ
  }
});

// FABãƒœã‚¿ãƒ³ã‚’è¿½åŠ ï¼ˆæœ¬æ£šã‚¿ãƒ–ç”¨ï¼‰
const fab = document.createElement('button');
fab.className = 'header-btn primary';
fab.style.cssText = 'position:fixed;bottom:90px;right:20px;width:56px;height:56px;border-radius:50%;font-size:28px;z-index:50;display:none;box-shadow:0 4px 12px rgba(0,0,0,0.3);';
fab.textContent = '+';
fab.addEventListener('click', () => {
  document.getElementById('addBookModal').classList.add('active');
});
document.body.appendChild(fab);

// ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ™‚ã«FABè¡¨ç¤º/éè¡¨ç¤º
const originalSwitchTab = switchTab;
switchTab = function(name) {
  originalSwitchTab(name);
  fab.style.display = name === 'books' ? 'flex' : 'none';
};

document.getElementById('linkToggle').addEventListener('click', () => {
  const fields = document.getElementById('linkFields');
  const isOpen = fields.classList.toggle('open');
  document.getElementById('linkIcon').textContent = isOpen ? 'âˆ’' : '+';
});

document.getElementById('addBookBtn').addEventListener('click', () => addBook(true));
document.getElementById('addBookNoXpBtn').addEventListener('click', () => addBook(false));
document.getElementById('saveEditBtn').addEventListener('click', saveEditBook);

document.getElementById('resetBtn').addEventListener('click', () => {
  document.getElementById('resetConfirm').classList.add('active');
});

document.getElementById('confirmResetBtn').addEventListener('click', () => {
  localStorage.removeItem(STORAGE_KEY);
  state = createInitialState();
  updateUI();
  closeModal('resetConfirm');
  closeModal('settingsModal');
  showToast('ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ');
});

document.getElementById('confirmDeleteBtn').addEventListener('click', confirmDeleteBook);
document.getElementById('confirmLinkBtn').addEventListener('click', confirmOpenLink);

document.getElementById('closeLevelup').addEventListener('click', () => {
  document.getElementById('levelupOverlay').classList.remove('active');
});

document.getElementById('closeTitle').addEventListener('click', () => {
  document.getElementById('titleOverlay').classList.remove('active');
});

// é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³
document.querySelectorAll('[data-close]').forEach(btn => {
  btn.addEventListener('click', () => closeModal(btn.dataset.close));
});

// ãƒ¢ãƒ¼ãƒ€ãƒ«èƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
document.querySelectorAll('.modal-overlay').forEach(overlay => {
  overlay.addEventListener('click', (e) => {
    if (e.target === overlay) overlay.classList.remove('active');
  });
});

// ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ä½ç½®èª¿æ•´ï¼ˆç«¯ã§è¦‹åˆ‡ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹ï¼‰
document.getElementById('shelf').addEventListener('mouseenter', (e) => {
  if (!e.target.classList.contains('mini-book')) return;

  const tooltip = e.target.querySelector('.book-tooltip');
  if (!tooltip) return;

  // ä¸€æ—¦ã‚¯ãƒ©ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆ
  tooltip.classList.remove('tooltip-align-left', 'tooltip-align-right');

  // æœ¬ã®ä¸­å¿ƒä½ç½®ã¨ç”»é¢ä¸­å¤®ã‹ã‚‰ã®è·é›¢ã§åˆ¤æ–­
  const bookRect = e.target.getBoundingClientRect();
  const bookCenter = bookRect.left + bookRect.width / 2;
  const screenCenter = window.innerWidth / 2;
  const threshold = window.innerWidth * 0.15; // ä¸­å¤®ã‹ã‚‰15%ä»¥ä¸Šé›¢ã‚ŒãŸã‚‰èª¿æ•´

  // ç”»é¢ä¸­å¤®ã‚ˆã‚Šå·¦ã«ã‚ã‚‹å ´åˆ â†’ ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚’å³å¯„ã›
  if (bookCenter < screenCenter - threshold) {
    tooltip.classList.add('tooltip-align-left');
  }
  // ç”»é¢ä¸­å¤®ã‚ˆã‚Šå³ã«ã‚ã‚‹å ´åˆ â†’ ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚’å·¦å¯„ã›
  else if (bookCenter > screenCenter + threshold) {
    tooltip.classList.add('tooltip-align-right');
  }
}, true);

// åˆæœŸåŒ–
updateUI();
</script>

</body>
</html>